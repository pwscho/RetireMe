<Window x:Class="RetireMe.UI.Views.ResultsSummary"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        mc:Ignorable="d"
        Title="Results Summary"
        Height="700"
        Width="1100"
        WindowStartupLocation="CenterOwner">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="30"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Text="{Binding Scenario.Name}" Grid.Row="0" HorizontalAlignment="Left" Width="auto" FontWeight="Bold"
                               FontSize="16"
                               Margin="0 0 0 8"/>
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 0 0 10">
            <Button Content="Export to Excel" Command="{Binding ExportToExcelCommand}" Margin="0 0 10 0"/>
        </StackPanel>

        <!-- ========================================================= -->
        <!-- SUMMARY STATISTICS PANEL -->
        <!-- ========================================================= -->
        <Border Background="#F5F5F5"
                Padding="15"
                CornerRadius="6"
                BorderBrush="#DDD"
                BorderThickness="1"
                Grid.Row="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- FIXED -->
                <StackPanel Grid.Row="1" Grid.Column="0">
                    <TextBlock Text="Fixed Simulation"
                               FontWeight="Bold"
                               FontSize="16"
                               Margin="0 0 0 8"/>
                    <TextBlock Text="{Binding FixedSuccessRate, StringFormat=Success Rate: {0:P1}}"/>
                    <TextBlock Text="{Binding FixedAvgBalance, StringFormat=Avg Ending Balance: {0:C0}}"/>
                    <TextBlock Text="{Binding FixedMedBalance, StringFormat=Median Ending Balance: {0:C0}}"/>
                    <TextBlock Text="{Binding FixedTaxesPaid, StringFormat=Avg Taxes Paid: {0:C0}}"/>
                </StackPanel>

                <!-- HISTORICAL -->
                <StackPanel Grid.Column="1">
                    <TextBlock Text="Historical Simulation"
                               FontWeight="Bold"
                               FontSize="16"
                               Margin="0 0 0 8"/>
                    <TextBlock Text="{Binding SequenceSuccessRate, StringFormat=Success Rate: {0:P1}}"/>
                    <TextBlock Text="{Binding SequenceAvgBalance, StringFormat=Avg Ending Balance: {0:C0}}"/>
                    <TextBlock Text="{Binding SequenceMedBalance, StringFormat=Median Ending Balance: {0:C0}}"/>
                    <TextBlock Text="{Binding SequenceTaxesPaid, StringFormat=Avg Taxes Paid: {0:C0}}"/>
                    <TextBlock Text="{Binding Sequence10thPercentile, StringFormat=10th Percentile: {0:C0}}"/>
                    <TextBlock Text="{Binding Sequence90thPercentile, StringFormat=90th Percentile: {0:C0}}"/>
                </StackPanel>

                <!-- MONTE CARLO -->
                <StackPanel Grid.Column="2">
                    <TextBlock Text="Monte Carlo Simulation"
                               FontWeight="Bold"
                               FontSize="16"
                               Margin="0 0 0 8"/>
                    <TextBlock Text="{Binding RandomSuccessRate, StringFormat=Success Rate: {0:P1}}"/>
                    <TextBlock Text="{Binding RandomAvgBalance, StringFormat=Avg Ending Balance: {0:C0}}"/>
                    <TextBlock Text="{Binding RandomMedBalance, StringFormat=Median Ending Balance: {0:C0}}"/>
                    <TextBlock Text="{Binding RandomTaxesPaid, StringFormat=Avg Taxes Paid: {0:C0}}"/>
                    <TextBlock Text="{Binding Random10thPercentile, StringFormat=10th Percentile: {0:C0}}"/>
                    <TextBlock Text="{Binding Random90thPercentile, StringFormat=90th Percentile: {0:C0}}"/>
                </StackPanel>
            </Grid>
        </Border>




        <!-- ========================================================= -->
        <!-- TAB CONTROL WITH FOUR TABS (INCLUDING CHARTS) -->
        <!-- ========================================================= -->
        <TabControl Grid.Row="2" Margin="0 20 0 0">

            <!-- FIXED -->
            <TabItem Header="Fixed">
                <DataGrid ItemsSource="{Binding ListOfFixedResults}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          Margin="0 10 0 0">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Year" Binding="{Binding Year}" />
                        <DataGridTextColumn Header="Age" Binding="{Binding AgeDisplay}" />
                        <DataGridTextColumn Header="Start Balance" Binding="{Binding StartingBalance, StringFormat=C}" />
                        <DataGridTextColumn Header="Income" Binding="{Binding Income, StringFormat=C}" />
                        <DataGridTextColumn Header="Social Security" Binding="{Binding SocialSecurityIncome, StringFormat=C}" />
                        <DataGridTextColumn Header="Investment Return" Binding="{Binding InvestmentReturn, StringFormat=C}" />
                        <DataGridTextColumn Header="Spending" Binding="{Binding Withdrawal, StringFormat=C}" />
                        <DataGridTextColumn Header="Taxes Paid" Binding="{Binding TaxesPaid, StringFormat=C}" />
                        <DataGridTextColumn Header="IRMAA Paid" Binding="{Binding IrmaaPaid, StringFormat=C}" />
                        <DataGridTextColumn Header="End Balance" Binding="{Binding EndingBalance, StringFormat=C}" />
                        <DataGridTextColumn Header="RMDs" Binding="{Binding Rmds, StringFormat=C}" />
                        <DataGridTextColumn Header="Conversions" Binding="{Binding Conversions, StringFormat=C0}" Width="100"/>
                        <DataGridTextColumn Header="Taxable Income" Binding="{Binding TaxableIncome, StringFormat=C}" />
                        <DataGridTextColumn Header="Ordinary Income" Binding="{Binding OrdinaryIncome, StringFormat=C}" />
                        <DataGridTextColumn Header="Capital Gains" Binding="{Binding CapitalGains, StringFormat=C}" />
                        <DataGridTextColumn Header="Taxes Due" Binding="{Binding TaxesDue, StringFormat=C}" />
                        <DataGridTextColumn Header="Acct Withdrawal" Binding="{Binding AccountWithdrawals, StringFormat=C}" />
                        <DataGridTextColumn Header="Percent Withdrawal" Binding="{Binding PercentWithdrawals, StringFormat=P}" />

                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- HISTORICAL -->
            <TabItem Header="Historical">
                <DataGrid ItemsSource="{Binding ListOfHistoricalResults}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          Margin="0 10 0 0">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Year" Binding="{Binding Year}" />
                        <DataGridTextColumn Header="Age" Binding="{Binding AgeDisplay}" />
                        <DataGridTextColumn Header="Start Balance" Binding="{Binding StartingBalance, StringFormat=C}" />
                        <DataGridTextColumn Header="Income" Binding="{Binding Income, StringFormat=C}" />
                        <DataGridTextColumn Header="Social Security" Binding="{Binding SocialSecurityIncome, StringFormat=C}" />
                        <DataGridTextColumn Header="Investment Return" Binding="{Binding InvestmentReturn, StringFormat=C}" />
                        <DataGridTextColumn Header="Spending" Binding="{Binding Withdrawal, StringFormat=C}" />
                        <DataGridTextColumn Header="Taxes Paid" Binding="{Binding TaxesPaid, StringFormat=C}" />
                        <DataGridTextColumn Header="IRMAA Paid" Binding="{Binding IrmaaPaid, StringFormat=C}" />
                        <DataGridTextColumn Header="End Balance" Binding="{Binding EndingBalance, StringFormat=C}" />
                        <DataGridTextColumn Header="RMDs" Binding="{Binding Rmds, StringFormat=C}" />
                        <DataGridTextColumn Header="Conversions" Binding="{Binding Conversions, StringFormat=C0}" Width="100"/>
                        <DataGridTextColumn Header="Taxable Income" Binding="{Binding TaxableIncome, StringFormat=C}" />
                        <DataGridTextColumn Header="Ordinary Income" Binding="{Binding OrdinaryIncome, StringFormat=C}" />
                        <DataGridTextColumn Header="Capital Gains" Binding="{Binding CapitalGains, StringFormat=C}" />
                        <DataGridTextColumn Header="Taxes Due" Binding="{Binding TaxesDue, StringFormat=C}" />
                        <DataGridTextColumn Header="Acct Withdrawal" Binding="{Binding AccountWithdrawals, StringFormat=C}" />
                        <DataGridTextColumn Header="Percent Withdrawal" Binding="{Binding PercentWithdrawals, StringFormat=P}" />

                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- MONTE CARLO -->
            <TabItem Header="Monte Carlo">
                <DataGrid ItemsSource="{Binding ListOfMonteCarloResults}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          Margin="0 10 0 0">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Year" Binding="{Binding Year}" />
                        <DataGridTextColumn Header="Age" Binding="{Binding AgeDisplay}" />
                        <DataGridTextColumn Header="Start Balance" Binding="{Binding StartingBalance, StringFormat=C}" />
                        <DataGridTextColumn Header="Income" Binding="{Binding Income, StringFormat=C}" />
                        <DataGridTextColumn Header="Social Security" Binding="{Binding SocialSecurityIncome, StringFormat=C}" />
                        <DataGridTextColumn Header="Investment Return" Binding="{Binding InvestmentReturn, StringFormat=C}" />
                        <DataGridTextColumn Header="Spending" Binding="{Binding Withdrawal, StringFormat=C}" />
                        <DataGridTextColumn Header="Taxes Paid" Binding="{Binding TaxesPaid, StringFormat=C}" />
                        <DataGridTextColumn Header="IRMAA Paid" Binding="{Binding IrmaaPaid, StringFormat=C}" />
                        <DataGridTextColumn Header="End Balance" Binding="{Binding EndingBalance, StringFormat=C}" />
                        <DataGridTextColumn Header="RMDs" Binding="{Binding Rmds, StringFormat=C}" />
                        <DataGridTextColumn Header="Conversions" Binding="{Binding Conversions, StringFormat=C0}" Width="100"/>
                        <DataGridTextColumn Header="Taxable Income" Binding="{Binding TaxableIncome, StringFormat=C}" />
                        <DataGridTextColumn Header="Ordinary Income" Binding="{Binding OrdinaryIncome, StringFormat=C}" />
                        <DataGridTextColumn Header="Capital Gains" Binding="{Binding CapitalGains, StringFormat=C}" />
                        <DataGridTextColumn Header="Taxes Due" Binding="{Binding TaxesDue, StringFormat=C}" />
                        <DataGridTextColumn Header="Acct Withdrawal" Binding="{Binding AccountWithdrawals, StringFormat=C}" />
                        <DataGridTextColumn Header="Percent Withdrawal" Binding="{Binding PercentWithdrawals, StringFormat=P}" />

                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- CHARTS -->
            <TabItem Header="Monte Carlo Graphs">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="13*"/>
                            <ColumnDefinition Width="1004*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition Height="300"/>
                            <!-- Histogram -->
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="300"/>
                            <!-- Trajectories -->
                        </Grid.RowDefinitions>
                        <!-- Histogram Title -->
                        <TextBlock Grid.Row="0" Text="Monte Carlo Ending Balance Distribution" FontSize="18" FontWeight="Bold" Margin="0 0 0 10" Grid.ColumnSpan="2"/>
                        <!-- Histogram Chart -->
                        <Border Grid.Row="1" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Padding="10" Background="White" Grid.ColumnSpan="2" Margin="0,0,0,300" Grid.RowSpan="3">
                            <lvc:CartesianChart Series="{Binding MonteCarloSeries}">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Labels="{Binding MonteCarloLabels}" LabelsRotation="45"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Frequency"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </Border>
                        <TextBlock Grid.Row="3" Text="Trajectory Percentile Bands (10th / 50th / 90th)" FontSize="18" FontWeight="Bold" Margin="0 20 0 10" Grid.ColumnSpan="2"/>
                        <Border Grid.Row="3" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Padding="10" Background="White" Grid.ColumnSpan="2">
                            <lvc:CartesianChart Series="{Binding PercentileSeries}">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Year" Labels="{Binding TrajectoryYears}" />
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Balance" LabelFormatter="{Binding CurrencyFormatter}" />
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Fixed Results Graphs">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="300"/>
                            <!-- Inflows -->
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="300"/>
                            <!-- Outflows -->
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="Income Sources" FontSize="18" FontWeight="Bold" Margin="0 0 0 10"/>
                        <Border Grid.Row="1" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Padding="10" Background="White">
                            <lvc:CartesianChart Series="{Binding StackedIncomeSeries}">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Year"
                          Labels="{Binding StackedIncomeLabels}" />
                                </lvc:CartesianChart.AxisX>

                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Amount" />
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </Border>
                        <TextBlock Grid.Row="2" Text="Outflows" FontSize="18" FontWeight="Bold" Margin="0 0 0 10"/>
                        <Border Grid.Row="3" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Padding="10" Background="White">
                            <lvc:CartesianChart Series="{Binding StackedSpendingSeries}">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Year" Labels="{Binding StackedSpendingLabels}" />
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Amount" />
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Historical Graphs">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="300"/>
                            <!-- Inflows -->
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="300"/>
                            <!-- Outflows -->
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="Historical Outcomes" FontSize="18" FontWeight="Bold" Margin="0 0 0 10"/>
                        <Border Grid.Row="1" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Padding="10" Background="White">
                            <lvc:CartesianChart Series="{Binding HistoricalEndingSeries}" DisableAnimations="True" Background="White" UseLayoutRounding="True">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Year" Labels="{Binding HistoricalEndingLabels}" />
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Ending Balance" LabelFormatter="{Binding DollarFormatter}" />
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </Border>
                        <TextBlock Grid.Row="2" Text="TBD" FontSize="18" FontWeight="Bold" Margin="0 0 0 10"/>
                        <Border Grid.Row="3" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Padding="10" Background="White">

                        </Border>
                    </Grid>
                </ScrollViewer>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
